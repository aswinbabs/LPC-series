/******************************************************************************/
/* DRAM.INI: DRAM Initialization File                                         */
/******************************************************************************/
// <<< Use Configuration Wizard in Context Menu >>>                           // 
/******************************************************************************/
/* This file is part of the uVision/ARM development tools.                    */
/* Copyright (c) 2005-2006 Keil Software. All rights reserved.                */
/* This software may only be used under the terms of a valid, current,        */
/* end user licence from KEIL for a compatible version of KEIL software       */
/* development tools. Nothing else gives you the right to use this software.  */
/******************************************************************************/


FUNC void Setup (void) {

// <h> External Memory Controller
//   <h> DRAM Controller

//     <h> DBWC: DRAM Bus Width Control
//       <o1.0..1>  BWDRAM: DRAM Bus Width
//         <0=> Not Present  <1=> 8-bits  <2=> 16-bits  <3=> Reserved
//     </h>
  _WDWORD(0x78180000, 0x00000002);   // DBWC

//     <h> DRMC: DRAM Control
//       <o1.0..1>  AMUX: Column Length
//         <0=> 8-bits  <1=> 9-bits  <2=> 10-bits  <3=> Reserved
//       <o1.2>     ARCH: DRAM Type
//         <0=> SDRAM  <1=> EDO-DRAM
//       <o1.4>     PRELAT: SDRAM Pre-charge latency
//         <0=> 2 cycles  <1=> CAS latency
//       <o1.6>     PDWN: SDRAM Power Down Mode
//         <0=> Disable automatic shift  <1=> Enable automatic shift
//       <o1.7>     RFRSH: CBR - CAS before RAS Refresh
//         <0=> Stop distributed CBR  <1=> Enable distributed CBR
//     </h>
  _WDWORD(0x78180004, 0x00000080);   // DRMC

//     <h> DRPC: DRAM Characteristics Control
//       <o1.0..3>  DRAMSPEC: DRAM Timming (in cycles)
//         <0=>  SDRAM:RCD=1,RAS=2,RP=1,DPL=1; EDO-DRAM:RAH/CAS=1,RCD=2,CAC/OEZ=1,RP=1
//         <1=>  SDRAM:RCD=1,RAS=3,RP=1,DPL=1; EDO-DRAM:RAH/CAS=1,RCD=2,CAC/OEZ=1,RP=2
//         <2=>  SDRAM:RCD=2,RAS=3,RP=2,DPL=1; EDO-DRAM:RAH/CAS=1,RCD=3,CAC/OEZ=1,RP=2
//         <3=>  SDRAM:RCD=2,RAS=4,RP=2,DPL=1; EDO-DRAM:RAH/CAS=1,RCD=3,CAC/OEZ=1,RP=3
//         <4=>  SDRAM:RCD=2,RAS=4,RP=2,DPL=2; EDO-DRAM:RAH/CAS=1,RCD=3,CAC/OEZ=2,RP=3
//         <5=>  SDRAM:RCD=2,RAS=5,RP=2,DPL=1; EDO-DRAM:RAH/CAS=1,RCD=4,CAC/OEZ=2,RP=4
//         <6=>  SDRAM:RCD=2,RAS=5,RP=2,DPL=2; EDO-DRAM:RAH/CAS=1,RCD=5,CAC/OEZ=2,RP=5
//         <7=>  SDRAM:RCD=2,RAS=5,RP=3,DPL=1; EDO-DRAM:RAH/CAS=2,RCD=4,CAC/OEZ=2,RP=4
//         <8=>  SDRAM:RCD=3,RAS=5,RP=3,DPL=2; EDO-DRAM:RAH/CAS=2,RCD=5,CAC/OEZ=2,RP=5
//         <9=>  SDRAM:RCD=3,RAS=6,RP=3,DPL=2; EDO-DRAM:RAH/CAS=2,RCD=6,CAC/OEZ=2,RP=6
//         <10=> SDRAM:Reserved; EDO-DRAM:RAH/CAS=3,RCD=8,CAC/OEZ=3,RP=7
//         <11=> Reserved <12=> Reserved <13=> Reserved <14=> Reserved <15=> Reserved
//     </h>
  _WDWORD(0x78180008, 0x00000009);   // DRPC

//     <h> SDMD: SDRAM Mode
//       <o10.0>  LTMODE: SDRAM CAS Latency
//         <0=> 2 cycles  <1=> 3 cycles
//     </h>
  _WDWORD(0x7818000C, 0x00000080);   // SDMD

//     <h> RFSH0: DRAM Refresh Cycle Control 0
//       <o11.0>  RCCON: DRAM Refresh Period
//         <0=> Double RSFH1 Period  <1=> Single RFSH1 Period
//     </h>
  _WDWORD(0x78180014, 0x00000001);   // RFSH0

//     <h> RFSH1: DRAM Refresh Cycle Control 1
//       <o12.0..10>  RFSEL1: DRAM Refresh Period Divider <8-2047>
//         <i> Refresh Period = CCLK / RFSEL1
//     </h>
  _WDWORD(0x7818001C, 0x000003A9);   // RFSH1

//     <h> PDWC: DRAM Power Down Control
//       <o13.0..3>  PDCNT: DRAM Idle Cycles before Power Down
//         <0=>  1 or more cycles   <1=>   2 or more cycles
//         <2=>  3 or more cycles   <3=>   4 or more cycles
//         <4=>  5 or more cycles   <5=>   6 or more cycles
//         <6=>  7 or more cycles   <7=>   8 or more cycles
//         <8=>  9 or more cycles   <9=>  10 or more cycles
//         <10=> 11 or more cycles  <11=> 12 or more cycles
//         <12=> 13 or more cycles  <13=> 14 or more cycles
//         <14=> 15 or more cycles  <15=> 16 or more cycles
//     </h>
  _WDWORD(0x78180018, 0x0000000F);   // PDWC

// DRAM Initialization Command
  _WDWORD(0x78180010, 0x00000004);   // DCMD = DCMD_PALL
  _WDWORD(0x78180010, 0x00000005);   // DCMD = DCMD_REF
  _WDWORD(0x78180010, 0x00000005);   // DCMD = DCMD_REF
  _WDWORD(0x78180010, 0x00000005);   // DCMD = DCMD_REF
  _WDWORD(0x78180010, 0x00000005);   // DCMD = DCMD_REF
  _WDWORD(0x78180010, 0x00000005);   // DCMD = DCMD_REF
  _WDWORD(0x78180010, 0x00000005);   // DCMD = DCMD_REF
  _WDWORD(0x78180010, 0x00000005);   // DCMD = DCMD_REF
  _WDWORD(0x78180010, 0x00000005);   // DCMD = DCMD_REF

//   </h>
// </h>

// <o> Program Entry Point
  PC = 0xC0000000;
}

Setup();                             // Setup for Downlaod

LOAD DRAM\Blinky.axf INCREMENTAL     // Download

g, main
